# GetCare System Design Document

This document outlines the detailed design for the GetCare system, incorporating the requirements for Doctor and Admin/Secretary modules, leveraging Laravel for the backend, PostgreSQL for the database, and integrating various external services.

## 1. Project Analysis

The existing project is a standard Laravel 7.x application, indicated by the `composer.json` file. It currently includes basic user authentication tables (`users`, `password_resets`, `failed_jobs`). This design will build upon this foundation by adding new modules and functionalities.

## 2. Database Schema Design

The following ER Diagram illustrates the proposed database schema, including new tables and relationships required for the system's functionality.

```mermaid
erDiagram
    USERS {
        UUID id PK
        string name
        string email UK
        datetime email_verified_at
        string password
        string user_type ENUM("admin", "doctor", "patient")
        datetime created_at
        datetime updated_at
    }

    ROLES {
        UUID id PK
        string name UK
        datetime created_at
        datetime updated_at
    }

    MODEL_HAS_ROLES {
        UUID role_id PK
        UUID model_id PK
        string model_type PK
    }

    DOCTORS {
        UUID id PK
        UUID user_id FK
        UUID specialty_id FK
        string medical_license_number UK
        string contact_number
        string address
        TEXT bio
        datetime created_at
        datetime updated_at
    }

    SPECIALTIES {
        UUID id PK
        string name UK
        TEXT description
        datetime created_at
        datetime updated_at
    }

    PATIENTS {
        UUID id PK
        UUID user_id FK
        string contact_number
        string address
        date date_of_birth
        string gender
        datetime created_at
        datetime updated_at
    }

    APPOINTMENTS {
        UUID id PK
        UUID patient_id FK
        UUID doctor_id FK
        datetime appointment_datetime
        string type ENUM("online", "face-to-face")
        string status ENUM("scheduled", "completed", "cancelled", "rescheduled")
        string google_meet_link
        datetime created_at
        datetime updated_at
    }

    CONSULTATIONS {
        UUID id PK
        UUID appointment_id FK
        TEXT consultation_notes
        TEXT ai_recommendations
        datetime consultation_datetime
        datetime created_at
        datetime updated_at
    }

    PRESCRIPTIONS {
        UUID id PK
        UUID consultation_id FK
        string medication_name
        string dosage
        string frequency
        TEXT instructions
        datetime created_at
        datetime updated_at
    }

    LAB_REQUESTS {
        UUID id PK
        UUID consultation_id FK
        string test_name
        TEXT instructions
        string status ENUM("pending", "completed")
        datetime created_at
        datetime updated_at
    }

    PAYMENTS {
        UUID id PK
        UUID user_id FK "Patient or Doctor"
        string payable_type
        UUID payable_id FK
        decimal amount
        string currency
        string payment_method ENUM("gcash", "bank_transfer", "card_maya")
        string transaction_id UK
        string status ENUM("pending", "completed", "failed")
        datetime payment_date
        datetime created_at
        datetime updated_at
    }

    SUBSCRIPTIONS {
        UUID id PK
        UUID patient_id FK
        string plan_name
        decimal amount
        datetime start_date
        datetime end_date
        string status ENUM("active", "inactive", "cancelled")
        datetime created_at
        datetime updated_at
    }

    AUDIT_LOGS {
        UUID id PK
        UUID user_id FK
        string event_type
        TEXT description
        string ip_address
        string user_agent
        datetime created_at
        datetime updated_at
    }

    USERS ||--o{ DOCTORS : "has one"
    USERS ||--o{ PATIENTS : "has one"
    USERS ||--o{ PAYMENTS : "made by"
    DOCTORS ||--o{ APPOINTMENTS : "has many"
    PATIENTS ||--o{ APPOINTMENTS : "has many"
    APPOINTMENTS ||--o{ CONSULTATIONS : "has one"
    CONSULTATIONS ||--o{ PRESCRIPTIONS : "has many"
    CONSULTATIONS ||--o{ LAB_REQUESTS : "has many"
    PATIENTS ||--o{ SUBSCRIPTIONS : "has many"
    SPECIALTIES ||--o{ DOCTORS : "has many"
    USERS ||--o{ AUDIT_LOGS : "generated by"
    ROLES ||--o{ MODEL_HAS_ROLES : "has many"
    USERS ||--o{ MODEL_HAS_ROLES : "has many"
```

## 3. API Endpoints

The API will be RESTful, using JSON for requests and responses, and authenticated via token-based authentication (e.g., Laravel Passport or Sanctum).

### Authentication & Authorization

*   **POST /api/login:** User login.
*   **POST /api/register:** Patient registration.
*   **POST /api/admin/doctors:** Admin creates doctor account.
*   **POST /api/logout:** User logout.

### User Management (Admin)

*   **GET /api/admin/doctors:** Retrieve all doctor accounts.
*   **GET /api/admin/doctors/{id}:** Retrieve specific doctor details.
*   **PUT /api/admin/doctors/{id}:** Update doctor account.
*   **DELETE /api/admin/doctors/{id}:** Delete doctor account.
*   **GET /api/admin/patients:** Retrieve all patient accounts.
*   **GET /api/admin/patients/{id}:** Retrieve specific patient details.

### Doctor Module

*   **GET /api/doctor/profile:** Retrieve authenticated doctor's profile.
*   **PUT /api/doctor/profile:** Update authenticated doctor's profile.
*   **POST /api/doctor/availability:** Configure doctor's availability.
*   **GET /api/doctor/availability:** Retrieve doctor's availability.

### Patient Module

*   **GET /api/patient/profile:** Retrieve authenticated patient's profile.
*   **PUT /api/patient/profile:** Update authenticated patient's profile.
*   **GET /api/patient/my-doctors:** Retrieve patient's assigned doctors.
*   **GET /api/patient/health-records:** Retrieve patient's health records with AI recommendations.

### Appointment Management

*   **POST /api/appointments:** Book an appointment.
*   **GET /api/admin/appointments:** Retrieve all appointments (Admin).
*   **GET /api/doctor/appointments:** Retrieve doctor's appointments.
*   **GET /api/patient/appointments:** Retrieve patient's appointments.
*   **PUT /api/appointments/{id}/status:** Update appointment status.
*   **PUT /api/appointments/{id}/reschedule:** Reschedule an appointment.

### Consultation & AI Integration

*   **POST /api/consultations/start:** Initiate a consultation session.
*   **PUT /api/consultations/{id}/notes:** Add/update consultation notes.
*   **POST /api/consultations/ai-recommendations:** Request AI recommendations for patient record data.
*   **POST /api/prescriptions:** Create new prescription.
*   **POST /api/lab-requests:** Create new lab request.

### Payment & Subscription

*   **GET /api/patient/subscriptions:** Retrieve patient's subscription history.
*   **POST /api/subscriptions:** Create new patient subscription.
*   **GET /api/doctor/earnings:** Retrieve doctor's earnings.
*   **POST /api/payments/callback:** Endpoint for payment gateway webhooks.

### Reporting & Monitoring (Admin)

*   **GET /api/admin/consultations:** Retrieve all consultation records.
*   **GET /api/admin/doctors/{id}/performance:** Retrieve performance metrics for a specific doctor.
*   **GET /api/admin/audit-logs:** Retrieve system audit logs.

## 4. User Interface Components

The frontend will likely be a React/Next.js application, consuming the Laravel API.

### General Components

*   Login/Registration Forms
*   Dashboard (personalized for each user type)
*   Navigation (Sidebar/Header)
*   Profile Management

### Doctor Module UI

*   **Doctor Dashboard:** Upcoming appointments, quick links, earnings summary.
*   **Availability & Schedule Management:** Calendar view, time slot forms.
*   **Patient Consultations:** Patient list, health record viewer (with AI insights), consultation interface (Google Meet integration, notes, prescriptions, lab requests), collaboration tools, treatment plan tracker.
*   **Payments & Earnings Dashboard:** Payment summary, transaction history, withdrawal requests.

### Admin/Secretary Module UI

*   **Admin Dashboard:** System overview, quick links.
*   **User Account Management:** Doctor management (list, create, edit, delete), Patient management (list, view details).
*   **Appointment Oversight:** Calendar/list view of all appointments, options to filter, cancel, reschedule, reassign.
*   **Consultation & Patient Details Access:** Access to patient health records, direct messaging.
*   **Monitoring & Reporting:** Doctor performance metrics, consultation history viewer.
*   **Subscription & Payment Oversight:** List of subscriptions, transaction monitoring.
*   **Compliance & Audit Logging:** Audit log viewer.

## 5. High-Level Architecture

```mermaid
graph LR
    subgraph Client Applications
        A[Web Browser / Mobile App] --HTTP/S--> B(Frontend Application - React/Next.js)
    end

    subgraph Backend Services (Laravel)
        B --API Calls--> C(Laravel Backend API)
        C --Database Access--> D(PostgreSQL Database)
        C --External API Calls--> E(Google Meet API)
        C --External API Calls--> F(AI Service)
        C --External API Calls--> G(Payment Gateways - GCash, Maya)
        C --Internal/External Sync--> H(Audit Logging Service)
    end

    subgraph External Services
        E[Google Meet]
        F[AI Service (e.g., GPT for recommendations)]
        G[Payment Gateways]
        H[Audit Logging / Monitoring]
    end

    subgraph Data Flow
        D --Data Storage--> I(User Data)
        D --Data Storage--> J(Doctor Data)
        D --Data Storage--> K(Patient Data)
        D --Data Storage--> L(Appointment Data)
        D --Data Storage--> M(Consultation/Health Records)
        D --Data Storage--> N(Payment/Subscription Data)
    end

    I --- D
    J --- D
    K --- D
    L --- D
    M --- D
    N --- D
```

## 6. AI Integration Points for Recommendations

**Contextual AI Recommendations during Patient Consultations:**

*   **Trigger:** When a doctor accesses a patient's health record or is conducting a live consultation.
*   **Data Input:** Patient demographics, past consultations (notes, diagnoses, treatments, prescriptions, lab results), and current symptoms/concerns.
*   **AI Processing:** The Laravel backend sends structured patient data to a dedicated AI service. The AI service processes this data to identify patterns, suggest diagnoses, recommend tests/referrals, highlight drug interactions, and summarize key information.
*   **Output:** Structured recommendations returned to Laravel.
*   **Display:** Recommendations displayed in the consultation UI as suggestions.
*   **Technical Considerations:** Selection of AI service (e.g., GPT), dedicated API endpoint, data anonymization for privacy, latency for real-time interaction, explainability (XAI), and feedback loop mechanisms.

## 7. Payment Gateway Integrations

The system will handle patient subscriptions and doctor payouts using:

*   **GCash & Maya:** Integrated via a third-party payment gateway provider (e.g., PayMongo) for consolidated API access, handling payment initiation, user redirection, and webhook notifications for status updates.
*   **Bank Transfer:**
    *   **Patient Subscriptions:** Manual/semi-automated process involving displaying bank details, unique reference numbers, and admin verification of manual transfers.
    *   **Doctor Payouts:** Primarily manual bank transfers initiated by admin from the system, with automated options considered for future enhancements using disbursement APIs.
*   **General Approach:** Laravel backend orchestrates payments, utilizes webhooks for real-time updates, logs all transactions in the `Payments` table, and implements robust error handling.
*   **Security:** Adherence to PCI DSS, data encryption (at rest and in transit), secure storage of API keys, and secure communication.

## 8. Compliance Requirements

The system will comply with the Philippine Data Privacy Act (RA 10173) and implement robust audit logging.

### Philippine Data Privacy Act (PDPA) Compliance

*   **Transparency:** Clear and accessible Privacy Policy, explicit consent for sensitive data.
*   **Legitimacy & Proportionality:** Data collected for legitimate purposes, only necessary data collected.
*   **Data Subject Rights:** Mechanisms for Right to Be Informed, Access, Object, Erasure/Blocking, Damages, Data Portability, and Rectification.
*   **Data Security:** Encryption (at rest/in transit), strict Role-Based Access Control (RBAC), secure development practices, data minimization, defined data retention, and breach notification protocols.

### Audit Logging

*   **AUDIT_LOGS Table:** Central to tracking events.
*   **What to Log:** User authentication, data access/modifications (who, what, when), system configuration changes, API calls, security events.
*   **Log Details:** Sufficient detail to reconstruct events, including IP address and user agent.
*   **Implementation:** Utilize Laravel Events/Listeners and middleware for automated logging.
*   **Log Security:** Audit logs protected from unauthorized access/modification, securely stored and backed up.

## 9. Future Enhancements

*   **Optional HMO integration:** For billing and insurance verification.
*   **Enhanced AI triage:** With predictive risk scoring.
